---
layout: post
title: ownCloud 8.2.1 to 8.2.2
tags: ownCloud
---

ownCloudのクライアントがアップデートされたのでサーバ側に 8.2.2 がきていたみたい。サーバ側もさっそくアップデート………と思ったらエラーでる。

```
Update failed. Unable to move /ownCloudDIR/_oc-upgrade/8.2.2.2/core/resources to /ownCloudDIR/resources
```

調べてみたら[バグ情報](https://github.com/owncloud/updater/issues/189)が上がっており、[パッチも公開](https://github.com/owncloud/updater/pull/192/files)されていた。  
修正箇所は1ヶ所なのでエディタでちょこちょこっと修正した。

修正ファイルは `/ownCloudDIR/apps/updater/lib/location/core.php` です。  
下記のように `$fullList['8.1'] → $fullList['8.2']` にするだけ。

```
--- core.php.old	2015-12-21 08:30:55.000000000 +0900
+++ core.php	2016-02-27 09:21:28.000000000 +0900
@@ -23,7 +23,7 @@
	protected function getWhitelist(){
		$strList = file_get_contents(dirname(__DIR__) . '/files.json');
		$fullList = json_decode($strList, true);
-		$list = $fullList['8.1'];
+		$list = $fullList['8.2'];
		return $list;
	}
```

上記のパッチを当てたあとに再度アップデートを行うと無事に終了。